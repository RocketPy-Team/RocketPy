Ensemble
========

RocketPy allows you to use ensemble forecasts and reanalysis to simulate the
atmospheric conditions for your rocket launch. Ensemble forecasts are a set of
forecasts generated by running a model multiple times with slightly different
initial conditions. This allows you to account for the uncertainty in the
forecast and obtain a range of possible outcomes.

.. tip::

    Ensemble models are extremely useful when running Monte Carlo simulations
    with RocketPy, as it allows you to add a level of uncertainty to your
    Environment model. One member forecast of the ensemble can be selected to
    run each flight simulation.


Ensemble Forecast
-----------------

Global Ensemble Forecast System (GEFS)
^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

The ``GEFS`` model is a global ensemble forecast model ...


.. code-block:: python

    from datetime import date, timedelta
    from rocketpy import Environment

    tomorrow = date.today() + timedelta(days=1)

    env_gefs = Environment(
        date=(tomorrow.year, tomorrow.month, tomorrow.day, 18),
        latitude=-21.960641,
        longitude=-47.482122,
        elevation=640,
    )
    env_gefs.set_atmospheric_model(type="Ensemble", file="GEFS")


.. By default, the 0th forecast member is activated, which means that using EnvGFS
.. will be exactly the same as using the 0th forecast member, and all other
.. forecasts are kept away stored.
.. Changing this is as easy as the following line of code.

.. code-block:: python

    env_gefs.select_ensemble_member(3) # selects the 3rd forecast member


.. Now, a new forecast is active and EnvGFS behaves as if ensemble member 1 was its only forecast.

A very useful thing is to compare the forecast of all ensemble members, as well
as confirming how many are there.
All of this can be done by calling the :meth:`rocketpy.Environment.all_info` method.

.. code-block:: python

    env_gefs.all_info()


CMC Ensemble
^^^^^^^^^^^^

.. danger::

    **CMC Ensemble Model Unavailable**: The CMC Ensemble model is temporarily \
    deactivated in RocketPy due to recent updates on NOAA's website, which \
    resulted in a change of the model's endpoint. Efforts are underway to \
    restore access to the CMC Ensemble model as swiftly as possible.

.. code-block:: python

    env_cmc = Environment(
        date=date_info,
        latitude=-21.960641,
        longitude=-47.482122,
        elevation=640,
    )
    env_cmc.set_atmospheric_model(type="Ensemble", file="CMC")
    env_cmc.all_info()


Ensemble Reanalysis
-------------------

Ensemble reanalyses are also possible with RocketPy. See the
:ref:`reanalysis_ensemble` section for more information.
